{% extends 'base.html' %}

{% block title %}Cart{% endblock %}

{% block css %}
<link href="{{ url_for('static', filename='base.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='cart.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='modal.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}

<div id="cart-container">

    {% if products_in_cart %}
    <h1>Products in your cart!</h1>
        {% for product, quantity in products_in_cart %}
        <div class="product-item">
        <div class="product-details">
            <h3>{{ product.title }}</h3>
            <h5>Quantity: {{ quantity }}</h5>
            <h5>${{ product.price }}</h5>
            <h5>Subtotal Price: ${{ product.price * quantity }}</h5>
        </div>

        <div id="upcart">
            <form id="upform" action="{{ url_for('update_cart') }}" method="POST">
                <input type="hidden" name="product_id" value="{{ product.id }}">
                <button id="inc" type="submit" name="action" value="decrease">-</button>
                <input id="finp" type="number" name="quantity" value="{{ quantity }}" min="1">
                <button id="inc" type="submit" name="action" value="increase">+</button>
            </form>
        </div>
        

        <div class="action-buttons">
            <!-- More Info button for each item -->
            <button type="button" class="btn btn-info btn-sm info" data-toggle="modal" data-target="#Modal-MoreInfo{{ product.id }}">
                More Info
            </button>
            <!-- Delete button for each item -->
            <form method="POST" action="{{ url_for('delete_item_from_cart', item_id=product.id) }}">
                <button type="submit" class="btn btn-danger btn-sm delete">Delete</button>
            </form>
        </div>
    </div>
        {% endfor %}

    
        <h4>Total Price: ${{ total_price }}</h4>
        <!-- Checkout button -->
        <button type="button" class="btn checkout" data-toggle="modal" data-target="#checkoutModal">
            Place an Order!
        </button>

        <!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1" role="dialog" aria-labelledby="checkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkoutModalLabel">Checkout</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- List of items in the cart -->
                <ul class="list-group">
                    {% for product, quantity in products_in_cart %}
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>{{ product.title }}</span>
                                <span>Quantity: {{ quantity }}</span>
                                <span>Total Price: ${{ product.price * quantity }}</span>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                <p class="mt-3">Total Price: ${{ total_price }}</p>
                <!-- Add your checkout form here -->
                <form method="POST" action="/checkout">
                    <!-- Include any necessary form fields -->
                    <button type="submit" class="btn btn-success">Confirm Checkout</button>
                </form>
            </div>
        </div>
    </div>
</div>

    {% else %}
        <h1>You don't have any items in your cart.</h1>
        <button class="goto-btn"><a href="{{ url_for('market') }}" style="text-decoration: none; color: white;">Browse the market</a></button>
    {% endif %}
</div>


<!-- More Info Modals -->
{% for product, quantity in products_in_cart %}
<div class="modal fade" id="Modal-MoreInfo{{ product.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalLabel">
                    {{ product.title }}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body modal-container">
                <img alt="{{ product.title }}" src="{{ product.image }}">
                <h1>Price: ${{ product.price }}</h1>
                <h2>Sub total: ${{ product.price * quantity }}</h2>
                <h3>Quantity: {{ quantity }}</h3>
                <!-- Add any other product details here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %}
